# How to implement LIO-SAM, FAST-LIO
last update 2023 7.24 by Seongbo Ha. <br>

ğŸš¨ LiDAR, IMUë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, LiDARì™€ IMUê°€ ë³´ë‚´ëŠ” timestampê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•¨

ë‹¤ìŒ ë¬¸ì„œ ë¨¼ì € í™•ì¸

[]([https://www.notion.so/How-to-synchronize-LiDAR-and-IMU-2995223dfa1c44f79dacacc71eaa3177](https://github.com/Lab-of-AI-and-Robotics/Lair_Code_Implementation_Manual/blob/main/manual/7.%20How_to_synchronize_LiDAR_and_IMU.md))

# LiDAR, IMU

ì—…ë°ì´íŠ¸ ì˜ˆì •

# LIO-SAM

- Install dependencies

```bash
## Ros dependeices
sudo apt-get install -y ros-$ROS_DISTRO-navigation
sudo apt-get install -y ros-$ROS_DISTRO-localization
sudo apt-get install -y ros-$ROS_DISTRO-state-publisher

## gtsam
sudo add-apt-repository ppa:borglab/gtsam-release-4.0
sudo apt install libgtsam-dev libgtsam-unstable-dev
```

- Download package

```bash
cd <your workspace>/src
git clone https://github.com/TixiaoShan/LIO-SAM.git
cd ..
catkin_make
```

- Edit config file (LIO-SAM/config/params.yaml)

Pointcloud, IMU í† í”½ëª… ë°”ê¿”ì£¼ê¸°

```yaml
lio_sam:

  # Topics
  pointCloudTopic: "Pointcloud í† í”½ëª… ex)ouster/points"               # Point cloud data
  imuTopic: "IMU í† í”½ëª… ex>imu"                                       # IMU data
  odomTopic: "odometry/imu"                                          # IMU pre-preintegration odometry, same frequency as IMU
  gpsTopic: "odometry/gpsz"
```

LiDAR ì„¤ì •

Unitree GO1ì˜ LiDARëŠ” Ouster OS1-64ì´ë¯€ë¡œ ì—¬ê¸°ì— ë§ê²Œ ìˆ˜ì •

```yaml
# Sensor Settings
  sensor: ouster                            # lidar sensor type, 'velodyne' or 'ouster' or 'livox'
  N_SCAN: 64             <---- ìˆ˜ì •                     # number of lidar channel (i.e., Velodyne/Ouster: 16, 32, 64, 128, Livox Horizon: 6)
  Horizon_SCAN: 1024     <---- ìˆ˜ì •                     # lidar horizontal resolution (Velodyne:1800, Ouster:512,1024,2048, Livox Horizon: 4000)
  downsampleRate: 1                           # default: 1. Downsample your data if too many points. i.e., 16 = 64 / 4, 16 = 16 / 1
  lidarMinRange: 1.0                          # default: 1.0, minimum lidar range to be used
  lidarMaxRange: 1000.0
```

LiDARì™€ IMUì˜ ìœ„ì¹˜ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” extrinsic parameter ìˆ˜ì •

ì˜ˆì‹œ 1) 

```yaml
# Extrinsics: T_lb (lidar -> imu)
  extrinsicTrans: [0.0, 0.0, 0.0]            
  extrinsicRot: [-1, 0, 0,   
                  0, 1, 0,
                  0, 0, -1]
  extrinsicRPY: [0, -1, 0,
                 1, 0, 0,
                 0, 0, 1]
```

ì˜ˆì‹œ 2) ìš°ë¦¬êº¼

```yaml
# Extrinsics: T_lb (lidar -> imu)
  extrinsicTrans: [0.0, 0.0, 0.0]
  extrinsicRot: [1, 0, 0,
                  0, 1, 0,
                  0, 0, 1]
  extrinsicRPY: [1, 0, 0,
                 0, 1, 0,
                 0, 0, 1]
```

- Run

```bash
### LIO-SAM/config/params.yamlì— ê¸°ë¡ëœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™€ ì‹¤í–‰
roslaunch lio_sam run.launch
```

# FAST-LIO

- Download dependencies

```bash
cd <your workspace>/src
git clone https://github.com/Livox-SDK/livox_ros_driver.git
```

- Download package

```bash
cd <your workspace>/src
git clone https://github.com/hku-mars/FAST_LIO.git
cd FAST_LIO
git submodule update --init
cd ../..
catkin_make
```

- Edit config file
    - ì‚¬ìš©í•˜ëŠ” LiDARì— ë”°ë¼ config file ìˆ˜ì •
        - Ouster 64ì±„ë„ : config/ouster64.yaml
        - Velodyne : config/velodyne.yaml

ì˜ˆì‹œ ) config/ouster64.yaml

Pointcloud, IMU dataì˜ í† í”½ëª… ìˆ˜ì •

```bash
common:
    lid_topic:  "pointcloud í† í”½ëª… ex) /ouster/points"
    imu_topic:  "IMU data í† í”½ëª… ex) /imu"
```

LiDAR, IMUì˜ ìœ„ì¹˜ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Extrinsic parameter ìˆ˜ì •

ìˆ˜ì •ë°©ë²•ì€ LIO-SAMê³¼ ë™ì¼

```bash
mapping:
    acc_cov: 0.1
    gyr_cov: 0.1
    b_acc_cov: 0.0001
    b_gyr_cov: 0.0001
    fov_degree:    180
    det_range:     150.0
    extrinsic_est_en:  false      # true: enable the online estimation of IMU-LiDAR extrinsic
    extrinsic_T: [ 0.0, 0.0, 0.0 ]         <------------------- ê±°ì˜ ìˆ˜ì •í• í•„ìš” X
    extrinsic_R: [1, 0, 0,                 <------------------- Extrinsic parameter (ìˆ˜ì •í•  parameter)
                  0, 1, 0,
                  0, 0, 1]
```

- Run

```bash
### Ouster ì‚¬ìš©ì‹œ
roslaunch fast_lio mapping_ouster64.launch

### Velodyne ì‚¬ìš©ì‹œ
roslaunch fast_lio mapping_velodyne.launch
```
