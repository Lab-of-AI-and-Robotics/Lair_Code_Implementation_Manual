# How to Use Docker
last update 2023.10.11 by Seongbo Ha. <br>


## Environment
Ubuntu 20.04

<br>

## Install

#### Install docker
```bash
sudo apt-get update
sudo apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
```
설치 확인
```bash
docker --version
```

#### Docker without sudo
```bash
sudo usermod -aG docker ${USER}
logout
```

#### To use gui in docker environment
```bash
sudo apt-get update
sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

<br>

## How to use
#### Docker system
<img width="50%" src="https://github.com/Lab-of-AI-and-Robotics/Lair_Code_Implementation_Manual/blob/main/images/docker_1.png"/>

#### Make docker image
Todo

#### Run container

```bash
docker run -it -v [공유할 디렉토리:대상 디렉토리] --name [컨테이너 이름] [태그명:이미지명] /bin/bash
```
-v
  - 원래 컴퓨터의 디렉토리와 컨테이너(가상환경)의 디렉토리를 공유하고자 하는 경우 사용
  - 공유할 디렉토리
    - 원래 컴퓨터에서 컨테이너와 공유하고자 하는 디렉토리 주소 입력
  - 대상 디렉토리
    - 원래 컴퓨터의 "공유할 디렉토리"를 컨테이너(가상환경)의 어느 경로와 연결할지 정의
  - 예시
    - -v ~/dataset:/home/dataset 으로 사용한 경우
      - 원래 컴퓨터의 ~/dataset 폴더와 컨테이너(가상환경)의 /home/dataset 폴더가 연결된다
#### Run container with GUI
컨테이너에서 GUI를 사용하려면 컨테이너를 실행할 때 별도의 옵션을 사용해야 한다.

```bash
docker run -it -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=$DISPLAY -e USER=$USER -e runtime=nvidia -e NVIDIA_DRIVER_CAPABILITIES=all -e NVIDIA_VISIBLE_DEVICES=all --net host --gpus all --privileged --name [컨테이너 이름] [태그명:이미지명] /bin/bash
```

<br>

## Docker with ROS